<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.11.1 from src/site/markdown/quick-start.md at 2023-10-03
 | Rendered using Apache Maven Fluido Skin 1.10.0
-->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="generator" content="Apache Maven Doxia Site Renderer 1.11.1" />
    <title>dbus-java &#x2013; DBus-Java Quickstart</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.10.0.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />
    <script src="./js/apache-maven-fluido-1.10.0.min.js"></script>
  </head>
  <body class="topBarDisabled">
    <div class="container-fluid">
      <header>
        <div id="banner">
          <div class="pull-left"><div id="bannerLeft"><h2>dbus-java</h2>
</div>
</div>
          <div class="pull-right"></div>
          <div class="clear"><hr/></div>
        </div>

        <div id="breadcrumbs">
          <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2023-10-03</li>
      <li id="projectVersion" class="pull-right">Version: 4.3.1</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://search.maven.org/search?q=g:com.github.hypfvieh%20dbus-java" class="externalLink" title="Maven Central">Maven Central</a></li>
      <li class="pull-right"><span class="divider">|</span>
<a href="https://www.github.com/hypfvieh/dbus-java/wiki" class="externalLink" title="GitHub Wiki">GitHub Wiki</a></li>
      <li class="pull-right"><a href="https://www.github.com/hypfvieh/dbus-java" class="externalLink" title="GitHub Repository">GitHub Repository</a></li>
          </ul>
        </div>
      </header>
      <div class="row-fluid">
        <header id="leftColumn" class="span2">
          <nav class="well sidebar-nav">
  <ul class="nav nav-list">
   <li class="nav-header">Overview</li>
    <li><a href="index.html" title="Home"><span class="none"></span>Home</a></li>
    <li class="active"><a href="#"><span class="none"></span>Quickstart</a></li>
    <li><a href="code-generation.html" title="Code Generation"><span class="none"></span>Code Generation</a></li>
    <li><a href="exporting-objects.html" title="Exporting Objects"><span class="none"></span>Exporting Objects</a></li>
    <li><a href="remote-objects.html" title="Calling Remote Objects"><span class="none"></span>Calling Remote Objects</a></li>
    <li><a href="howto.html" title="Howto..."><span class="none"></span>Howto...</a></li>
   <li class="nav-header">Project Documentation</li>
    <li><a href="project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
   <li class="nav-header">Modules</li>
    <li><a href="dbus-java-core/index.html" title="dbus-java-core"><span class="none"></span>dbus-java-core</a></li>
    <li><a href="dbus-java-osgi/index.html" title="dbus-java-osgi"><span class="none"></span>dbus-java-osgi</a></li>
    <li><a href="dbus-java-utils/index.html" title="dbus-java-utils"><span class="none"></span>dbus-java-utils</a></li>
    <li><a href="dbus-java-transport-jnr-unixsocket/index.html" title="dbus-java-transport-jnr-unixsocket"><span class="none"></span>dbus-java-transport-jnr-unixsocket</a></li>
    <li><a href="dbus-java-transport-junixsocket/index.html" title="dbus-java-transport-junixsocket"><span class="none"></span>dbus-java-transport-junixsocket</a></li>
    <li><a href="dbus-java-transport-tcp/index.html" title="dbus-java-transport-tcp"><span class="none"></span>dbus-java-transport-tcp</a></li>
    <li><a href="dbus-java-bom/index.html" title="dbus-java-bom"><span class="none"></span>dbus-java-bom</a></li>
    <li><a href="dbus-java-tests/index.html" title="dbus-java-tests"><span class="none"></span>dbus-java-tests</a></li>
    <li><a href="dbus-java-examples/index.html" title="dbus-java-examples"><span class="none"></span>dbus-java-examples</a></li>
    <li><a href="dbus-java-transport-native-unixsocket/index.html" title="dbus-java-transport-native-unixsocket"><span class="none"></span>dbus-java-transport-native-unixsocket</a></li>
  </ul>
          </nav>
          <div class="well sidebar-nav">
            <hr />
            <div id="poweredBy">
              <div class="clear"></div>
              <div class="clear"></div>
              <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </header>
        <main id="bodyColumn"  class="span10" >
<h1>DBus-Java Quickstart</h1>
<ol style="list-style-type: decimal">

<li>

<p>Add in dbus-java-core and a apropriate transport to your dependencies. <a href="./dependency-info.html">Documentation on adding to dependencies.</a></p>
</li>
<li>

<p>(optional) Add in a logging framework of your choice to see the log messages.
DBus-Java uses SLF4J internally for logging.</p>

<div class="source"><pre class="prettyprint"><code> &lt;!-- Example of using log4j2 as the logging implementation with Maven --&gt;
 &lt;dependencies&gt;
     &lt;!-- ... other dependencies here ... --&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
         &lt;artifactId&gt;log4j-api&lt;/artifactId&gt;
         &lt;version&gt;2.17.2&lt;/version&gt;
     &lt;/dependency&gt;
     &lt;dependency&gt;
         &lt;groupId&gt;org.apache.logging.log4j&lt;/groupId&gt;
         &lt;artifactId&gt;log4j-slf4j-impl&lt;/artifactId&gt;
         &lt;version&gt;2.17.2&lt;/version&gt;
     &lt;/dependency&gt;

 &lt;/dependencies&gt;
</code></pre></div>
</li>
<li>

<p>Get a connection to the bus. This can be either the SESSION bus or the SYSTEM bus.</p>

<div class="source"><pre class="prettyprint"><code> DBusConnection conn = DBusConnectionBuilder.forSessionBus().build();
</code></pre></div>
</li>
<li>

<p>Request bus name if you want a well-known bus name, or begin calling methods on the bus!
You only need to request a bus name if you are expecting other people to talk
to you, so that they know how to talk to you.</p>
</li>
</ol><section>
<h2><a name="Session_vs_System_bus"></a>Session vs System bus</h2>
<p>By default, there are two buses on the system for different purposes.  The
first bus, the session bus, is created on a per-user basis, generally when you
log in.  However, this bus may not be created unless you have a graphical
session.  This bus is used for session data such as notifications to the user,
property changes on the shell you are using, etc.</p>
<p>The second bus is the system bus.  There is only one system bus at a time, and
this bus contains information that is relevant to the system as a whole.  Some
of this data can be common to the session bus as well.  Data that may be on the
system bus includes things such as mount/unmount data, new devices found, etc.</p>
<p>Since there is only one system bus, it has more stringent security requirements.
You should always be able to listen to events on the system bus, but you may not
be able to request a bus name without updating some permissions.  The process
of updating permissions is outside the scope of this document; however, the XML
files that control the permissions can be found in <code>/etc/dbus-1/system.d</code>.</p></section><section>
<h2><a name="Connection_configuration"></a>Connection configuration</h2>
<p>If you do not have any special requirements, usually <code>DBusConnectionBuilder.forSessionBus().build()</code> or <code>DBusConnectionBuilder.forSystemBus().build()</code> is all you need to do.</p>
<p>In some cases you may have to change the default settings. This can be done through the appropriate builder options.
The Builder allows you to change most settings used to connect and to communicate with DBus.</p><section>
<h3><a name="Changing_thread-pool_settings"></a>Changing thread-pool settings</h3>
<p>For receiving data from DBus dbus-java uses several thread pools. This is required due to the different purposes of
received messages. There are signals, methods and method returns.
To prevent one message processing blocking other message processing, each of those message types are handled in different
thread pools.</p>
<p>The default settings is 1 thread per message type for signals, methods and errors. Method-Return messages have a thread pool
size of 4.</p>
<p>To change those settings, use the <code>receivingThreadConfig()</code> method on the connection builders.
Example:</p>

<div class="source"><pre class="prettyprint"><code>DBusConnectionBuilder.forSessionBus()
    .receivingThreadConfig()
        .withSignalThreadCount(4)
        .withMethodThreadCount(2)
    .connectionConfig()
    .withShared(false)
    .build()
</code></pre></div>
<p>In the example above, the signal thread pool will be increased to 4 threads, the method thread pool to 2 threads.
Calling <code>connectionConfig()</code> will return the used connection builder (<code>DBusConnectionBuilder</code> in this case) to allow configure further settings on the connection before creating the actual connection.
If you do not want to do additional configuration you can also call <code>.buildConnection()</code> on the <code>ReceivingServiceConfigBuilder</code> to create the connection directly.</p>
<p>With this pattern you can also change the thread priority for each pool.</p></section><section>
<h3><a name="IMPORTANT_NOTE_ABOUT_SIGNAL_THREADPOOL"></a>IMPORTANT NOTE ABOUT SIGNAL THREADPOOL</h3>
<p>Increasing the signal thread pool will improve the speed the signals are handled.
Nevertheless increasing the thread pool may also cause the signals to be handled in any order, not necessarily in the order
they were sent/received.</p>
<p>This is caused by concurrency of the threads in the pool. If you receive e.g. 10 signals and have 4 signal handler threads, 4 of them are handled in parallel and thread 3 might be finished before thread 1 is finished etc.</p>
<p>If signal order is important for your use case, DO NOT INCREMENT the signal thread pool size!</p></section><section>
<h3><a name="Using_retry_handler"></a>Using retry handler</h3>
<p>In some very rare cases (this has only been reported for some JDK versions of some vendors used on ARM 32-bit platform, see <a class="externalLink" href="https://github.com/hypfvieh/dbus-java/issues/172">#172</a>), the thread pool executors may throw unexpected NullPointerExceptions.</p>
<p>In such cases the default behavior is to retry adding the message callback runnable to the executor up to 10 times.
If adding still fails, the message callback runnable will be dropped (ignored) and an error will be logged.</p>
<p>You can change this behavior by installing a custom <code>IThreadPoolRetryHandler</code>.
This handler is a functional interface and can be expressed as lambda.
The handler will receive the executor type (<code>ExecutorNames</code> enum value) which failed execute a runnable and the
exception which was thrown in that case.
It should return <code>true</code> if the execution should be retried, or <code>false</code> to ignore the runnable.</p>
<p>In any case there is a &#x2018;hard&#x2019; limit of retries (to avoid spinning up CPU without any use) which is 50 currently.
After that hard limit is reached, error will be logged and runnable will be ignored.</p>
<p>You can also set the configured retry handler to <code>null</code> which will cause the <code>ReceivingService</code> log an error (including exception) and ignoring the failed runnable.</p>
<p>Retry handler can be installed like this:</p>

<div class="source"><pre class="prettyprint"><code>DBusConnectionBuilder.forSessionBus()
    .receivingThreadConfig()
        .withRetryHandler((t, ex) -&gt; {
            // do something useful and return true or false
            return false;
        })
    .connectionConfig()
    .withShared(false)
    .build()
</code></pre></div></section><section>
<h3><a name="IMPORTANT_NOTE_USING_RETRY_HANDLER"></a>IMPORTANT NOTE USING RETRY HANDLER</h3>
<p>The retry handler is executed synchronously (in the thread where the connection receives data from the bus).
That means whatever you do in your retry handler, either do it quick or delegate the actual work to your own thread pool/thread and do it asynchronously. Doing too much work in the retry handler will cause delays in other received messages and may cause DBus to disconnect the session.</p></section></section><section>
<h2><a name="Examples"></a>Examples</h2>
<p>For example code checkout dbus-java-examples module of this project.</p></section>
        </main>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>&#169;      2023
</p>
        </div>
      </div>
    </footer>
<script>
	if(anchors) {
	  anchors.add();
	}
</script>
  </body>
</html>
